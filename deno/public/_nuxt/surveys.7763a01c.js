import{l as w,u as P,n as f,r as v,o as T,c as O,a as r,t as n,b as s,w as l,d as g,i as m,m as V,F as q,h as B}from"./entry.d0f737aa.js";/* empty css             */import{_ as D}from"./_plugin-vue_export-helper.c27b6911.js";const N={class:"text-h4"},U={class:"mainGroup"},I=w(),$={position:"top-right",timeout:5e3,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!1,draggablePercent:.6,showCloseButtonOnHover:!0,hideProgressBar:!0,closeButton:"button",icon:!0,rtl:!1},F={data(){return{drawer:!0,rail:!0,surveys:[],tableItems:[],itemsPerPage:10,totalItems:0,search:"",loading:!0,token:"",deleteConfirm:!1,deleteItem:{},headers:[{align:"start",key:"id",sortable:!1,title:"ID"},{align:"start",key:"title",sortable:!1,title:"Title"},{align:"start",key:"description",sortable:!1,title:"Description"},{align:"start",key:"date",sortable:!0,title:"Date"},{align:"start",key:"enabled",sortable:!0,title:"Enabled"},{align:"start",key:"questions",sortable:!1,title:"Questions"},{align:"start",key:"view",sortable:!1,title:"View"}]}},methods:{loadItems({page:o,itemsPerPage:d,sortBy:e}){this.loading=!0,this.token&&$fetch("/api/survey/lists",{method:"POST",body:JSON.stringify({token:this.token,uniqueId:B().query.id,page:o,pagesize:d,sortBy:e,search:this.search})}).then(t=>{if(t.code==0){const i=[];for(const u in t.list)i.push({id:"#"+t.list[u].id.slice(-6),fullId:t.list[u].id,title:t.list[u].title,description:t.list[u].description,date:new Date(t.list[u].created_at).toLocaleString(),enabled:t.list[u].enable,questions:t.list[u].questions.length});this.tableItems=i,this.totalItems=t.count}else this.tableItems=[],this.totalItems=0;this.loading=!1})},desc(o){return typeof o!="string"||o.length<=80?o:(o=o.slice(0,80),o.endsWith(" ")?o.slice(0,79)+"...":o+"...")},async deleteSurvey(o){const d=sessionStorage.getItem("_cransurvey_token");(await $fetch("/api/survey/delete",{method:"POST",body:JSON.stringify({token:d,uniqueId:o})})).code==0?(I.success(this.$t("delete.success"),$),this.surveys=this.surveys.filter(t=>t.id!=o)):I.error(this.$t("delete.error"),$)}},async mounted(){for(const o in this.headers)this.headers[o].title=this.$t("surveys.headers."+this.headers[o].key);this.token=sessionStorage.getItem("_cransurvey_token"),this.loadItems({page:1,itemsPerPage:10}),this.username=sessionStorage.getItem("_cransurvey_usr")}},J=Object.assign(F,{__name:"surveys",setup(o){const d=P();{const e=sessionStorage.getItem("_cransurvey_token"),t=sessionStorage.getItem("_cransurvey_usr");!e||!t?f(d("/sign-in")):sessionStorage.getItem("_cransurvey_token_lock")||$fetch("/api/usr/token",{method:"POST",body:JSON.stringify({token:e})}).then(i=>{i.code==0?sessionStorage.setItem("_cransurvey_token_lock",!0):(sessionStorage.removeItem("_cransurvey_token"),sessionStorage.removeItem("_cransurvey_usr"),f(d("/sign-in")))})}return(e,t)=>{const i=v("v-btn"),u=v("v-text-field"),C=v("v-card-title"),h=v("v-card-text"),_=v("v-spacer"),k=v("v-card-actions"),p=v("v-card"),b=v("v-dialog"),S=v("v-data-table-server");return T(),O(q,null,[r("h1",N,n(e.$t("surveys.surveys")),1),s(i,{variant:"outlined",onClick:t[0]||(t[0]=a=>("navigateTo"in e?e.navigateTo:m(f))(m(d)("/dash/new"))),style:{"margin-top":"20px","margin-left":"8px"}},{default:l(()=>[g(n(e.$t("new.new")),1)]),_:1}),r("div",U,[s(p,{variant:"outlined",style:{margin:"20px auto",padding:"15px"},loading:e.loading},{text:l(()=>[s(u,{modelValue:e.search,"onUpdate:modelValue":t[1]||(t[1]=a=>e.search=a),label:e.$t("results.search"),"prepend-inner-icon":"mdi-magnify","single-line":"",variant:"outlined","hide-details":""},null,8,["modelValue","label"])]),default:l(()=>[s(h,null,{default:l(()=>[s(S,{headers:e.headers,items:e.tableItems,search:e.search,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[2]||(t[2]=a=>e.itemsPerPage=a),"items-length":e.totalItems,loading:e.loading,"onUpdate:options":e.loadItems,class:"resultsDataTable"},{item:l(({item:a})=>[r("tr",null,[r("td",null,n(a.id),1),r("td",null,n(a.title),1),r("td",null,n(e.desc(a.description)),1),r("td",null,n(a.date),1),r("td",null,n(e.$t("surveys.boolean."+a.enabled)),1),r("td",null,n(a.questions),1),s(b,{width:"500"},{activator:l(({props:y})=>[r("td",null,[s(i,V({variant:"tonal",density:"comfortable"},y),{default:l(()=>[g(n(e.$t("surveys.view")),1)]),_:2},1040)])]),default:l(({isActive:y})=>[s(p,null,{default:l(()=>[s(C,null,{default:l(()=>[g(n(e.$t("surveys.view")),1)]),_:1}),s(h,null,{default:l(()=>[r("p",null,n(e.$t("surveys.headers.id"))+": "+n(a.id),1),r("p",null,n(e.$t("surveys.headers.title"))+": "+n(a.title),1)]),_:2},1024),s(k,null,{default:l(()=>[s(_),s(i,{variant:"text",color:"primary",onClick:c=>("navigateTo"in e?e.navigateTo:m(f))(m(d)("/dash/new?id="+a.fullId))},{default:l(()=>[g(n(e.$t("edit.edit")),1)]),_:2},1032,["onClick"]),s(i,{variant:"text",color:"primary",onClick:c=>{e.deleteItem=a,e.deleteConfirm=!0}},{default:l(()=>[g(n(e.$t("results.delete")),1)]),_:2},1032,["onClick"]),s(i,{variant:"text",color:"primary",onClick:c=>("navigateTo"in e?e.navigateTo:m(f))(m(d)("/dash/share?id="+a.fullId))},{default:l(()=>[g(n(e.$t("share.share")),1)]),_:2},1032,["onClick"]),s(i,{variant:"text",color:"primary",onClick:c=>("navigateTo"in e?e.navigateTo:m(f))(m(d)("/dash/details?id="+a.fullId))},{default:l(()=>[g(n(e.$t("results.results")),1)]),_:2},1032,["onClick"]),s(i,{variant:"text",color:"primary",onClick:c=>y.value=!1},{default:l(()=>[g(n(e.$t("results.close")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:1},8,["headers","items","search","items-per-page","items-length","loading","onUpdate:options"])]),_:1})]),_:1},8,["loading"])]),s(b,{width:"500",modelValue:e.deleteConfirm,"onUpdate:modelValue":t[5]||(t[5]=a=>e.deleteConfirm=a)},{default:l(()=>[s(p,{title:e.$t("delete.warning")},{default:l(()=>[s(h,null,{default:l(()=>[g(n(e.$t("delete.warning_msg",{title:e.deleteItem.title})),1)]),_:1}),s(k,null,{default:l(()=>[s(_),s(i,{text:e.$t("delete.cancel"),onClick:t[3]||(t[3]=a=>e.deleteConfirm=!1)},null,8,["text"]),s(i,{text:e.$t("delete.confirm"),onClick:t[4]||(t[4]=a=>{e.deleteSurvey(e.deleteItem.fullId),e.deleteConfirm=!1})},null,8,["text"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])],64)}}}),j=D(J,[["__scopeId","data-v-42136489"]]);export{j as default};
