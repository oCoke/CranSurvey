import{u as q,n as P,r as d,o as i,c,a as t,t as n,b as o,w as l,m as N,d as k,F as b,f as V,g as O,h as T}from"./entry.d0f737aa.js";/* empty css             */const B={class:"text-h4"},L={class:"text-left"},A={class:"text-left"},F={class:"text-left"},J=["onClick"],j=["onClick"],z={key:0},E={key:1,style:{"text-decoration":"underline"}},R={key:2},W=t("b",null,"Question: ",-1),G=t("br",null,null,-1),H=t("b",null,"Answer: ",-1),K={key:0},M={key:1},X={key:2},Y={data(){return{headers:[{align:"start",key:"user",sortable:!1,title:"User"},{align:"start",key:"date",sortable:!0,title:"Date"},{align:"start",key:"answers",sortable:!1,title:"Answers"},{align:"start",key:"country",sortable:!1,title:"Country"},{align:"start",key:"city",sortable:!1,title:"City"}],tableItems:[],itemsPerPage:10,totalItems:0,loading:!0,token:"",search:"",surveyQuestions:[],dialogs:[]}},methods:{loadItems({page:r,itemsPerPage:m,sortBy:e}){console.log(e),this.loading=!0,$fetch("/api/survey/results",{method:"POST",body:JSON.stringify({token:this.token,uniqueId:T().query.id,page:r,pagesize:m,sortBy:e,search:this.search})}).then(a=>{if(a.code==0){const h=[];for(const u in a.answers)h.push({user:"#"+a.answers[u].usr.slice(-6),date:new Date(a.answers[u].created_at).toLocaleString(),answers:a.answers[u].ans.length,ans:a.answers[u].ans,country:a.answers[u].geoip[1],city:a.answers[u].geoip[0]});this.tableItems=h,this.totalItems=a.total,this.surveyQuestions=a.survey.questions}else this.tableItems=[],this.totalItems=0;this.loading=!1})},desc(r){return typeof r!="string"||r.length<=80?r:(r=r.slice(0,80),r.endsWith(" ")?r.slice(0,79)+"...":r+"...")}},mounted(){this.token=sessionStorage.getItem("_cransurvey_token"),this.loadItems({page:1,itemsPerPage:10}),this.headers=[{align:"start",key:"user",sortable:!1,title:this.$t("results.user")},{align:"start",key:"date",sortable:!0,title:this.$t("new.types.date")},{align:"start",key:"answers",sortable:!1,title:this.$t("results.answers")},{align:"start",key:"country",sortable:!1,title:this.$t("results.country")},{align:"start",key:"city",sortable:!1,title:this.$t("results.city")}]}},ee=Object.assign(Y,{__name:"details",setup(r){const m=q();{const e=sessionStorage.getItem("_cransurvey_token"),a=sessionStorage.getItem("_cransurvey_usr");!e||!a?P(m("/sign-in")):sessionStorage.getItem("_cransurvey_token_lock")||$fetch("/api/usr/token",{method:"POST",body:JSON.stringify({token:e})}).then(h=>{h.code==0?sessionStorage.setItem("_cransurvey_token_lock",!0):(sessionStorage.removeItem("_cransurvey_token"),sessionStorage.removeItem("_cransurvey_usr"),P(m("/sign-in")))})}return(e,a)=>{const h=d("v-text-field"),u=d("v-btn"),C=d("v-checkbox"),v=d("v-card-text"),w=d("v-spacer"),Q=d("v-card-actions"),_=d("v-card"),I=d("v-dialog"),S=d("v-table"),D=d("v-data-table-server");return i(),c(b,null,[t("h1",B,n(e.$t("results.results")),1),o(_,{variant:"outlined",style:{margin:"20px auto",padding:"15px"}},{text:l(()=>[o(h,{modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=y=>e.search=y),label:e.$t("results.search"),"prepend-inner-icon":"mdi-magnify","single-line":"",variant:"outlined","hide-details":""},null,8,["modelValue","label"])]),default:l(()=>[o(v,null,{default:l(()=>[o(D,{headers:e.headers,items:e.tableItems,search:e.search,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":a[1]||(a[1]=y=>e.itemsPerPage=y),"items-length":e.totalItems,loading:e.loading,"onUpdate:options":e.loadItems},{item:l(({item:y})=>[t("tr",null,[t("td",null,n(y.user),1),t("td",null,n(y.date),1),o(I,{width:"800"},{activator:l(({props:f})=>[t("td",null,[o(u,N({variant:"tonal",density:"comfortable"},f),{default:l(()=>[k("View")]),_:2},1040)])]),default:l(({isActive:f})=>[o(_,{title:e.$t("results.results")},{default:l(()=>[o(v,null,{default:l(()=>[o(S,null,{default:l(()=>[t("thead",null,[t("tr",null,[t("th",L,n(e.$t("results.question")),1),t("th",A,n(e.$t("results.answer")),1),t("th",F,n(e.$t("results.type")),1)])]),t("tbody",null,[(i(!0),c(b,null,V(y.ans,(p,s)=>(i(),c("tr",null,[t("td",{onClick:g=>e.dialogs[s]=!0,style:{cursor:"pointer"}},n(e.desc(e.surveyQuestions[s].question)),9,J),t("td",{onClick:g=>e.dialogs[s]=!0,style:{cursor:"pointer"}},[(e.surveyQuestions[s].type=="multiple"||e.surveyQuestions[s].type=="dropdown")&&e.surveyQuestions[s].options&&e.surveyQuestions[s].options.optionsData?(i(),c("span",z,n(e.surveyQuestions[s].options.optionsData[p.answer]),1)):e.surveyQuestions[s].type=="checkboxes"?(i(),c("span",E,n(e.$t("results.details")),1)):(i(),c("span",R,n(e.desc(p.answer)),1))],8,j),t("td",null,n(e.$t("new.types."+e.surveyQuestions[p.id].type)),1),o(I,{modelValue:e.dialogs[s],"onUpdate:modelValue":g=>e.dialogs[s]=g,width:"600"},{default:l(()=>[o(_,null,{default:l(()=>[o(v,null,{default:l(()=>[t("p",null,[W,k(n(e.surveyQuestions[s].question),1),G]),t("p",null,[H,(e.surveyQuestions[s].type=="multiple"||e.surveyQuestions[s].type=="dropdown")&&e.surveyQuestions[s].options&&e.surveyQuestions[s].options.optionsData?(i(),c("span",K,n(e.surveyQuestions[s].options.optionsData[p.answer]),1)):e.surveyQuestions[s].type=="checkboxes"&&e.surveyQuestions[s].options&&e.surveyQuestions[s].options.optionsData?(i(),c("span",M,[(i(!0),c(b,null,V(e.surveyQuestions[s].options.optionsData,(g,$)=>(i(),O(C,{"hide-details":"",disabled:"",class:"viewing-checkboxes",label:g,modelValue:p.answer[$],"onUpdate:modelValue":U=>p.answer[$]=U},null,8,["label","modelValue","onUpdate:modelValue"]))),256))])):(i(),c("span",X,n(p.answer),1))])]),_:2},1024),o(Q,null,{default:l(()=>[o(w),o(u,{color:"primary",onClick:g=>e.dialogs[s]=!1},{default:l(()=>[k("Close")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),256))])]),_:2},1024)]),_:2},1024),o(Q,null,{default:l(()=>[o(w),o(u,{text:"Close",onClick:p=>f.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024),t("td",null,n(y.country),1),t("td",null,n(y.city),1)])]),_:1},8,["headers","items","search","items-per-page","items-length","loading","onUpdate:options"])]),_:1})]),_:1})],64)}}});export{ee as default};
