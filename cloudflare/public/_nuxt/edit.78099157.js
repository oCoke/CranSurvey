import{l as $,u as V,h,n as w,r as o,o as U,c as O,a as v,t as _,i as d,b as s,w as r,d as g,F as C}from"./entry.dc320ebb.js";/* empty css             */import{m as f}from"./md5.d8309aa2.js";const I={class:"text-h4"},B={class:"mainGroup"},i=$(),u={position:"top-right",timeout:5e3,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,draggable:!1,draggablePercent:.6,showCloseButtonOnHover:!0,hideProgressBar:!0,closeButton:"button",icon:!0,rtl:!1},R={data(){return{drawer:!0,rail:!0,password:"",newPassword:"",newPasswordRe:""}},methods:{async updatePwd(){if(!this.password||!this.newPassword||!this.newPasswordRe)return i.error(this.$t("signup.invalid_params"),u),!1;if(this.newPassword!=this.newPasswordRe)return i.error(this.$t("signup.invalid_password"),u),!1;const l=await $fetch("/api/usr/update",{method:"POST",body:JSON.stringify({token:sessionStorage.getItem("_cransurvey_token"),username:h().query.username,password:f(this.password),newPassword:f(this.newPassword),type:"pwd"})});l.code==0?i.success(this.$t("editUser.update_success"),u):i.error(this.$t("editUser.update_error")+" ("+this.$t("error_codes."+l.code)+")",u)}},async mounted(){}},q=Object.assign(R,{__name:"edit",setup(l){const m=V(),n=h().query.username;{const e=sessionStorage.getItem("_cransurvey_token"),t=sessionStorage.getItem("_cransurvey_usr");!e||!t?w(m("/sign-in")):sessionStorage.getItem("_cransurvey_token_lock")||$fetch("/api/usr/token",{method:"POST",body:JSON.stringify({token:e})}).then(p=>{p.code==0?sessionStorage.setItem("_cransurvey_token_lock",!0):(sessionStorage.removeItem("_cransurvey_token"),sessionStorage.removeItem("_cransurvey_usr"),w(m("/sign-in")))})}return(e,t)=>{const p=o("v-card-title"),c=o("v-text-field"),y=o("v-spacer"),P=o("v-btn"),b=o("v-card-actions"),k=o("v-card-text"),S=o("v-card");return U(),O(C,null,[v("h1",I,_(e.$t("editUser.editUser",{username:d(n)})),1),v("div",B,[s(S,{variant:"outlined"},{default:r(()=>[s(p,null,{default:r(()=>[g(_(e.$t("editUser.password",{username:d(n)})),1)]),_:1}),s(k,{style:{"padding-bottom":"0"}},{default:r(()=>[s(c,{label:e.$t("signup.password"),type:"password",modelValue:e.password,"onUpdate:modelValue":t[0]||(t[0]=a=>e.password=a)},null,8,["label","modelValue"]),s(c,{label:e.$t("editUser.enter_password",{username:d(n)}),type:"password",modelValue:e.newPassword,"onUpdate:modelValue":t[1]||(t[1]=a=>e.newPassword=a)},null,8,["label","modelValue"]),s(c,{label:e.$t("editUser.enter_password_re",{username:d(n)}),type:"password",modelValue:e.newPasswordRe,"onUpdate:modelValue":t[2]||(t[2]=a=>e.newPasswordRe=a)},null,8,["label","modelValue"]),s(b,{style:{"padding-top":"0"}},{default:r(()=>[s(y),s(P,{variant:"text",onClick:e.updatePwd},{default:r(()=>[g(_(e.$t("editUser.update")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})])],64)}}});export{q as default};
